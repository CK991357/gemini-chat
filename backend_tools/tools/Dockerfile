# ä½¿ç”¨å®˜æ–¹çš„ Python 3.11 slim é•œåƒ (åŸºäºDebian)
FROM python:3.11-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# æ›¿æ¢Debianè½¯ä»¶æºä¸ºå›½å†…é•œåƒï¼ŒåŠ é€Ÿä¸‹è½½
# RUN sed -i 's/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list && \
#     sed -i 's/security.debian.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list

# å®‰è£…ç³»ç»Ÿä¾èµ–å’Œè½»é‡çº§å­—ä½“
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    ca-certificates \
    curl \
    # ğŸ”¥ æ ¸å¿ƒä¿®å¤ï¼šå¿…é¡»å®‰è£… Graphviz ç³»ç»Ÿåº“
    graphviz \
    # è½»é‡çº§ä¸­æ–‡å­—ä½“ï¼ˆé‡‘èå›¾è¡¨å¸¸ç”¨ï¼‰
    fonts-wqy-microhei \
    fonts-wqy-zenhei \
    # åŸºç¡€è‹±æ–‡å­—ä½“
    fonts-dejavu-core \
    fonts-liberation \
    fontconfig && \
    fc-cache -fv && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# è®¾ç½®matplotlibä½¿ç”¨Aggåç«¯ï¼ˆæ— GUIï¼Œé€‚åˆæœåŠ¡å™¨ï¼‰
ENV MPLBACKEND=Agg
ENV PYTHONUNBUFFERED=1

# å®‰è£… Python ä¾èµ–ï¼ˆä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå¹¶é”å®šç‰ˆæœ¬ï¼‰
RUN pip install --no-cache-dir -i https://pypi.tuna.tsinghua.edu.cn/simple \
    fastapi \
    uvicorn \
    python-multipart \
    docker \
    graphviz \
    pydot \
    networkx \
    numpy==1.26.4 \
    scipy==1.14.1 \
    pandas==2.2.2 \
    openpyxl==3.1.2 \
    sympy==1.12 \
    matplotlib==3.8.4 \
    seaborn==0.13.2 \
    statsmodels==0.14.1 \ 
    pyarrow==14.0.2 \  
    python-docx==1.1.2 \
    python-pptx==0.6.23 \
    reportlab==4.0.7 \
    tabulate==0.9.0  \
    lxml==5.2.2 \
    beautifulsoup4==4.12.3 \
    tabulate==0.9.0 \
    tqdm==4.66.4 \
    joblib==1.3.2 \
    aiofiles==24.1.0 \
    numexpr==2.10.0 \      
    bottleneck==1.3.8 \     
    duckdb==0.10.2 \        
    scikit-learn==1.5.0 \   
    scikit-optimize==0.9.0 \
    lightgbm==4.3.0 \     
    category_encoders==2.6.3 


# å¤åˆ¶æ‚¨çš„ code_interpreter.py æ–‡ä»¶åˆ°å®¹å™¨çš„ /app ç›®å½•
COPY code_interpreter.py .

# æš´éœ²åº”ç”¨ç¨‹åºç›‘å¬çš„ç«¯å£
EXPOSE 8828

# å®šä¹‰å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤
CMD ["uvicorn", "code_interpreter:app", "--host", "0.0.0.0", "--port", "8828", "--log-level", "info"]