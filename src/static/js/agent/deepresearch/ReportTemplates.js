// src/static/js/agent/deepresearch/ReportTemplates.js

export const ReportTemplates = {
    // ✨ 深度研究模式 - 优化章节结构
    // 🎯 【全新升级版】深度专家报告 (Deep Expert)
    deep: {
        name: "深度专家报告",
        description: "一份由AI自主规划、结构动态生成、聚焦最终成果的极致深度分析报告。",
        config: {
            // 🔥 1. 开启动态结构，赋予模型自主权
            dynamic_structure: true,

            // 🔥 2. 移除“研究脉-络”章节，聚焦最终成果
            structure: [
                "# [模型根据研究主题和核心发现，自主生成一个深刻、精炼、直指问题核心的主标题]",
                "## 摘要 (Executive Summary)",
                "   - [对整个研究最核心的洞察、最关键的结论进行高度浓缩的概括，约300-500字，面向决策者]",
                "## 一、引言：问题与背景 (Introduction: Problem & Context)",
                "   - [清晰地界定本次研究的核心问题、其重要性及当前的背景。阐述本报告将从哪些维度进行深度剖析。]",
                "## [二、三、四...] [根据研究计划中的'sub_question'，自主将每个步骤扩展成一个独立的、论证充分的核心章节]",
                "   - [章节标题应自主提炼，必须专业且能概括该章节的核心论点，而不是简单复述子问题。]",
                // ▼▼▼ 将“篇幅”要求改为“深度”要求 ▼▼▼
                "   - [本章是报告的核心，必须进行详细的、多角度的展开论述。你需要通过【至少三种】不同的论据（如：技术原理分析、模型案例对比、性能数据支撑、行业专家观点等）来支撑你的核心论点，确保内容的深度和说服力。]",
                "   - [每个章节内部，必须对相关的所有'观察(observation)'信息进行深度的综合、分析、提炼和论证，而不仅仅是罗列。]",
                "   - [必须包含对不同观点、技术路线或市场方案的【对比分析】和【辩证思考】。]",
                "   - [**深度标志**：报告中必须明确包含一个“辩证分析”或“多角度对比”的核心章节，专门用于探讨不同观点的冲突与融合、技术的优劣势权衡、或理论的局限性。]",
                "   - [所有关键数据、论点必须在句末清晰地引用资料来源，例如：'该技术路线的实现复杂度较高 [来源 1, 3]。']",
                "## 五、综合解决方案与战略建议 (Synthesized Solutions & Strategic Recommendations) (可选，如果适用)",
                "   - [基于前文的深度分析，设计出创新的、多层次的综合解决方案或战略框架。]",
                "   - [对每个方案进行SWOT分析（优势、劣势、机会、威胁），并给出明确的决策建议。]",
                "## 六、结论与未来展望 (Conclusion & Future Outlook)",
                "   - [全面总结报告的核心洞见，形成一个有穿透力的最终结论。]",
                "   - [基于研究结论，预测未来3-5年的发展趋势、潜在的颠覆性变量以及需要持续关注的关键问题。]",
                "## 资料来源 (Sources)",
                "   - [系统将自动附加此部分]"
            ],
            
            // 🔥 5. 大幅提升字数要求
            wordCount: "动态调整 (通常在8000-12000字，但以论证的彻底性为首要标准，不设上限)",
            style: "极致专业、逻辑严密、论证充分、富有洞察力、前瞻性。",
            requirements: "报告必须体现出对复杂问题的根本性解构和高度综合分析能力。**核心要求是论证的【彻底性】和【严谨性】，而非单纯的字数堆砌。** 确保每一个核心观点都有从【完整抓取内容（crawl4ai）】中提取充分的数据、案例或理论支撑，并进行了深入的辩证分析。"
        },
        researchMode: "deep"
    },

    // 📊 行业分析报告 - 完全重构
    business: {
        name: "行业深度投资分析报告",
        description: "基于最新市场数据的全方位行业扫描，融合产业视角与金融分析，为投资决策提供数据支撑",
        config: {
            // 🔥 启用动态结构，赋予Agent自主权
            dynamic_structure: true,
            
            structure: [
                "# [基于行业特性和核心发现，自主生成精炼专业的标题]",
                "## 执行摘要 (Executive Summary)",
                "   - [300-500字的浓缩版分析，面向投资决策者，突出核心投资逻辑和关键数据结论]",
                "",
                "## 一、行业全景扫描与核心定位",
                "### 1.1 行业定义与市场规模",
                "   - **行业范畴**: [明确行业边界和主要业务模式]",
                "   - **全球市场规模**: [最新数据，注明来源和年份]",
                "   - **中国市场规模**: [最新数据，注明来源和年份]",
                "   - **增长率分析**: [历史CAGR及短期预测]",
                "",
                "## 二、产业链深度解构与价值分布",
                "### 2.1 全产业链关键环节",
                "   - **上游供应链**: [核心原材料/技术供应商及集中度]",
                "   - **中游制造/服务**: [主要加工环节和代表性企业]",
                "   - **下游应用市场**: [终端客户结构和渠道特点]",
                "### 2.2 价值链与利润分布",
                "   - **各环节毛利率水平**: [关键环节利润率估算]",
                "   - **价值创造核心**: [识别高附加值环节]",
                "",
                "## 三、竞争格局与市场结构",
                "### 3.1 市场竞争态势",
                "   - **市场集中度**: [CR3/CR5指标及变化趋势]",
                "   - **头部企业分析**: [前3-5名企业市场份额和战略]",
                "   - **竞争壁垒**: [技术、资本、政策等进入门槛]",
                "### 3.2 新进入者与替代威胁",
                "   - **潜在竞争者**: [可能进入的跨界企业]",
                "   - **替代品压力**: [主要替代技术和产品]",
                "",
                "## 四、核心驱动因素与增长动力",
                "### 4.1 政策与技术驱动",
                "   - **关键政策影响**: [产业政策、补贴、监管变化]",
                "   - **技术创新推动**: [核心技术突破和应用]",
                "### 4.2 市场需求驱动",
                "   - **下游需求增长**: [主要应用领域需求变化]",
                "   - **消费升级趋势**: [产品/服务升级方向]",
                "",
                "## 五、风险识别与投资价值",
                "### 5.1 主要风险因素",
                "   - **系统性风险**: [政策变化、宏观经济影响]",
                "   - **行业特定风险**: [技术迭代、竞争加剧、供应链风险]",
                "### 5.2 投资价值评估",
                "   - **行业财务基准**: [平均毛利率、净利率水平]",
                "   - **估值参考**: [行业PE/PB区间及合理性]",
                "",
                "## 六、投资机会与战略建议",
                "### 6.1 机会识别",
                "   - **高增长细分领域**: [具体子行业或技术方向]",
                "   - **价值被低估环节**: [产业链中潜力环节]",
                "### 6.2 投资策略",
                "   - **进入时机建议**: [基于行业周期判断]",
                "   - **风险控制措施**: [具体风险规避策略]",
                "",
                "## 七、未来发展趋势展望",
                "### 7.1 市场规模预测",
                "   - **短期展望**: [未来1-2年发展趋势]",
                "   - **中长期趋势**: [3-5年技术方向和市场变化]",
                "",
                "## 资料来源与数据注解",
                "   - [系统将自动附加此部分]"
            ],
            
            // 🔥 大幅提升数据要求和时效性标准
            wordCount: "6000-8000字（以数据充分性为准，不设硬性上限）",
            style: "数据驱动、量化分析、投资导向、时效性强",
            
            requirements: `
## 🎯 行业深度分析核心要求

### 1. 数据驱动原则 (Data-Driven Principle)
- **每个核心观点必须有具体数据支撑**，禁止模糊描述
- **关键指标必须包含**：市场规模、增长率、市场份额、财务指标
- **数据时效性**：优先使用最近2年数据，重大变化必须使用最新数据

### 2. 时效性验证协议 (Temporal Validation Protocol)
- **市场数据**：必须验证是否为最新季度/年度数据
- **政策信息**：必须确认是否为现行有效政策
- **企业信息**：必须使用最新财务报告和经营数据
- **行业动态**：必须包含最近6个月的重要行业事件

### 3. 金融分析深度要求 (Financial Analysis Depth)
- **必须包含量化财务分析**：毛利率、净利率、ROE、资产负债率等
- **必须进行估值评估**：PE、PB等估值指标分析
- **必须包含投资回报分析**：历史回报和预期回报评估

### 4. 产业链分析标准 (Industry Chain Standards)
- **上游**：分析原材料供应稳定性、价格波动影响
- **中游**：分析制造/服务环节的竞争壁垒和利润水平
- **下游**：分析终端需求变化和渠道结构演变

### 5. 竞争格局分析框架 (Competitive Landscape Framework)
- **市场集中度**：计算并分析CR3、CR5、HHI指数
- **竞争策略**：分析主要参与者的差异化竞争手段
- **进入壁垒**：量化分析资本、技术、政策等壁垒高度

### 6. 风险收益平衡 (Risk-Return Balance)
- **系统性风险**：分析宏观经济和政策变化影响
- **非系统性风险**：识别行业内特定风险因素
- **风险调整收益**：基于风险水平的投资建议

### 7. 资料来源透明度 (Source Transparency)
- **每个数据点必须标注明确来源**和数据时间
- **优先使用权威来源**：统计局、行业协会、上市公司财报
- **交叉验证**：重要数据需要至少两个独立来源验证

### 8. 自适应结构调整 (Adaptive Structure)
Agent基于数据可获得性自主决定：
- 哪些细分领域需要重点分析
- 哪些财务指标最具代表性
- 哪些风险因素需要优先关注
- 报告深度和广度的最佳平衡点
`
        },
        researchMode: "business"
    },

    // 📝 学术论文整理模式 - 优化结构
    academic: {
        name: "学术论文深度解析报告",
        description: "对学术论文的全面深度分析，包括研究脉络、方法验证、相关工作和未来方向",
        config: {
            // 🔥 核心修改：启用动态结构
            dynamic_structure: true,
            
            structure: [
                "# [基于论文核心贡献和发现，自主生成一个深刻、精炼的学术标题]",
                "## 摘要 (Executive Summary)",
                "   - [对整个论文最核心的贡献、最关键的技术突破进行高度浓缩的概括，约300-500字，面向学术同行和决策者]",
                "## 一、引言：研究问题与学术定位 (Introduction: Research Problem & Academic Positioning)",
                "   - [清晰地界定论文要解决的核心学术问题、其在领域中的重要性及当前的技术瓶颈]",
                "   - [阐述本分析将从哪些维度进行深度剖析，以及论文在学术脉络中的定位]",
                "## [二、三、四...] [根据研究计划中的'sub_question'，自主将每个步骤扩展成独立的深度分析章节]",
                "   - [章节标题应自主提炼，必须专业且能概括该章节的核心学术论点，而不是简单复述子问题]",
                "   - [本章是分析的核心，必须进行详细的、多角度的技术展开。你需要通过【至少三种】不同的论据（如：技术原理深度解析、实验数据验证、与相关工作对比、理论创新分析等）来支撑你的核心论点]",
                "   - [每个章节内部，必须对相关的所有'观察(observation)'信息进行深度的学术综合、批判性分析和提炼论证]",
                "   - [必须包含对技术路线、方法选择、实验结果的不同观点或替代方案的【辩证分析】]",
                "   - [**深度标志**：报告中必须明确包含一个\"技术路线对比\"或\"方法优劣分析\"的核心章节，专门用于探讨不同技术方案的权衡、局限性和创新点]",
                "   - [所有关键技术论点、实验数据必须在句末清晰地引用资料来源，例如：'该方法的准确率比基线提升15.3% [来源 1, 3]']",
                "## [倒数第二章] 综合评估与学术贡献 (Synthesized Assessment & Academic Contributions)",
                "   - [基于前文的深度分析，系统评估论文的学术价值和技术创新]",
                "   - [对论文的贡献进行多维度总结：理论创新、方法突破、应用价值等]",
                "   - [客观分析论文的局限性和改进空间，提出建设性批判]",
                "## 结论与领域展望 (Conclusion & Field Outlook)",
                "   - [全面总结分析的核心洞见，形成有深度的最终评价]",
                "   - [基于论文贡献，预测该研究方向未来3-5年的发展趋势、技术演进路径和潜在突破点]",
                "## 资料来源 (Sources)",
                "   - [系统将自动附加此部分]"
            ],
            
            wordCount: "3000-5000字",
            style: "学术严谨、深度分析、批判性思维、结构化表达",
            requirements: "必须基于论文原文进行深度技术解析，每个核心观点都需要具体的技术细节和实验数据支撑。避免泛泛而谈，专注于学术价值和创新性分析。使用结构化表达增强可读性，突出核心贡献和技术突破。必须包含批判性思考和辩证分析。"
        },
        researchMode: "academic"
    },

    // 🛠️ 技术实现文档 - 优化结构
    technical: {
        name: "技术方案指引包",
        description: "从需求分析到落地实施的全流程技术指引，不包含具体代码实现",
        config: {
            dynamic_structure: true,
            structure: [
                "# [基于项目特点自主生成的技术方案标题]",
                "",
                "## 🎯 方案概述",
                "   - [用200-300字概括整个技术方案的核心价值和关键决策]",
                "",
                "## 一、需求规格分析",
                "   - [将用户自然语言描述转化为结构化需求]",
                "   - **业务目标**: [明确的核心价值主张]",
                "   - **功能范围**: [清晰的功能边界定义]",
                "   - **成功标准**: [可衡量的验收指标]",
                "   - **约束条件**: [已知的技术或资源限制]",
                "",
                "## 二、案例研究与最佳实践",
                "   - [基于搜索的同类项目分析]",
                "   - **成功模式借鉴**: [可复用的架构和设计模式]",
                "   - **避坑指南**: [常见问题及解决方案]",
                "   - **行业趋势**: [相关技术发展动向]",
                "",
                "## 三、技术架构设计",
                "   - [基于研究的架构方案]",
                "   - **架构模式选择**: [微服务/单体/其他] 及决策依据",
                "   - **组件设计思路**: [前后端分离、数据流设计等]",
                "   - **关键技术决策**: [核心架构选择的理由]",
                "   - **扩展性考虑**: [未来发展的架构预留]",
                "",
                "## 四、技术栈选型指南",
                "   - [稳定性优先的技术组合]",
                "   - **选型原则**: [基于的标准和考量因素]",
                "   - **技术组合建议**: [前端、后端、数据库等推荐]",
                "   - **版本稳定性分析**: [LTS版本和生产环境验证]",
                "   - **团队适配建议**: [基于技术背景的选型考量]",
                "",
                "## 五、项目结构与实施路线",
                "   - [可落地的实施指引]",
                "   - **推荐项目结构**: [目录组织和文件规划]",
                "   - **开发环境配置**: [工具链和环境建议]",
                "   - **实施阶段规划**: [分步骤的开发路线]",
                "   - **关键节点提醒**: [每个阶段的重要注意事项]",
                "",
                "## 六、部署与运维指南",
                "   - [生产环境准备]",
                "   - **部署架构建议**: [服务器、网络、存储规划]",
                "   - **监控与告警**: [关键指标和监控方案]",
                "   - **安全加固要点**: [必须关注的安全措施]",
                "   - **性能优化方向**: [可预见的性能瓶颈及解决思路]",
                "",
                "## 七、风险识别与应对",
                "   - [前瞻性风险分析]",
                "   - **技术风险**: [已知的技术挑战和解决方案]",
                "   - **团队风险**: [技能缺口和培训建议]",
                "   - **项目风险**: [时间、资源、范围管理建议]",
                "   - **应急计划**: [问题出现时的应对策略]",
                "",
                "## 下一步行动建议",
                "   - [具体的实施启动步骤]",
                "   - **立即行动项**: [可以马上开始的工作]",
                "   - **中期规划**: [接下来1-2周的重点]",
                "   - **长期展望**: [项目发展的技术演进]",
                "",
                "## 参考资料",
                "   - [系统将自动附加研究过程中使用的外部资料]"
            ],
            wordCount: "3000-5000字",
            style: "指引性、结构化、可执行",
            requirements: `
## 🎯 报告生成核心原则

### 严格遵循的定位：
**技术方案指引，不是代码实现**

### 内容要求：
1. **需求转化能力**: 必须将模糊的用户描述转化为清晰的结构化需求
2. **研究驱动决策**: 所有技术建议都要基于实际搜索的最佳实践
3. **落地可行性**: 提供的指引要具体可行，用户知道下一步该做什么
4. **风险前瞻性**: 提前识别可能的问题并提供解决方案

### 禁止内容：
- 具体的代码实现
- 完整的配置文件
- 可运行的代码片段
- 详细的API实现

### 重点突出：
- **架构思路**而不是具体实现
- **技术选型理由**而不是配置细节
- **实施步骤**而不是代码逻辑
- **风险预警**而不是技术细节

### 质量标准：
- 每个技术决策都有研究依据
- 每个建议都有明确的实施路径
- 每个风险都有对应的规避策略
- 整体方案具备直接落地的指导价值
`
        },
        researchMode: "technical"
    },

    // 🔥 修改后的数据挖掘模式 - 纯数据表格版
data_mining: {
    name: "纯数据表格报告",
    description: "专注于从DataBus中提取所有结构化数据并输出为表格，不包含任何描述性语言。",
    config: {
        dynamic_structure: true,
        
        // 🔥 简化场景适配器 - 只关注数据表格主题
        scenario_adapters: {
            // 1. 通用型（默认）
            generic: {
                table_themes: [
                    "核心数据汇总",
                    "补充数据表格",
                    "原始数据片段"
                ],
                requirements: `通用数据表格要求：
1. 将所有结构化数据转换为Markdown表格
2. 表格标题简明扼要
3. 每个表格末尾标注质量等级 [质量: X级]
4. 每行数据必须标注来源 [x]`
            },
            // 2. 科技产品对比型
            tech_comparison: {
                table_themes: [
                    "核心参数对比",
                    "性能测试数据", 
                    "成本与定价对比",
                    "生态支持对比",
                    "时间线数据"
                ],
                requirements: `科技产品对比表格要求：
1. 对比维度必须清晰（如：型号、年份、处理器、内存）
2. 性能数据必须包含单位
3. 价格数据必须包含货币单位
4. 技术参数必须准确`
            },
            // 3. 金融数据型
            financial: {
                table_themes: [
                    "财务指标对比", 
                    "市场表现数据",
                    "估值数据对比",
                    "风险指标数据",
                    "时间序列图表数据"
                ],
                requirements: `金融数据表格要求：
1. 财务指标符合会计准则
2. 货币单位必须统一
3. 时间频率必须明确（年/季/月）
4. 增长率必须标注计算方式`
            },
            // 4. 商业市场分析型
            business_data: {
                table_themes: [
                    "市场规模数据",
                    "企业竞争数据",
                    "产业链数据",
                    "财务指标对比",
                    "时间序列数据"
                ],
                requirements: `商业数据表格要求：
1. 市场数据必须包含区域范围
2. 企业数据必须包含市场份额
3. 产业链数据必须层级清晰
4. 时间数据必须连续`
            },
            // 5. 学术研究型
            academic_data: {
                table_themes: [
                    "实验数据",
                    "统计分析结果",
                    "文献引用数据", 
                    "方法论对比",
                    "原始实验数据"
                ],
                requirements: `学术数据表格要求：
1. 实验数据必须包含样本量
2. 统计方法必须说明
3. 引用数据必须准确
4. 方法论必须清晰`
            }
        },
        
        // 🔥 智能场景检测
        auto_scenario_detection: true,
        
        // 🔥 简化结构 - 只关注数据表格
        structure: [
            "# [数据报告标题]",
            "## 一、核心数据汇总",
            "## 二、补充数据表格",
            "## 三、原始数据片段",
        ],
        
        wordCount: "根据数据量动态调整,不限字数",
        style: "简洁、结构化、纯数据",
        
        // 🔥🔥🔥 核心修改：极度简化的纯数据要求
        requirements: `
## 🚫 绝对禁止 - 违反将导致报告无效
1. **禁止任何描述性语言**：不要添加概述、分析、总结、评估、说明、评价
2. **禁止主观内容**：不要使用"优秀"、"良好"、"显著"、"重要"等形容词
3. **禁止数据解读**：不要解释数据含义、趋势或结论
4. **禁止添加章节说明**：不要写"本章节包含..."、"下表展示了..."

## ✅ 唯一要求 - 只做以下事情
1. **提取DataBus所有数据**：将DataBus中的每个step_X的数据转换为表格
2. **质量等级标注**：每个表格标题后标注 [质量: X级]
3. **来源标注**：表格中必须包含来源编号 [x]
4. **原始格式保留**：保持数据的原始单位和格式
5. **完整数据优先**：优先使用DataBus中的完整原始数据

## 📊 输出格式 - 必须严格遵守
\`\`\`markdown
# [研究主题]

## 表1: [数据主题1] [质量: A级]
| 字段1 | 字段2 | 字段3 | 来源 |
|-------|-------|-------|------|
| 数据1 | 数据2 | 数据3 | [1],[3] |
| 数据4 | 数据5 | 数据6 | [2],[4] |

## 表2: [数据主题2] [质量: B级]
| 时间 | 数值 | 单位 | 来源 |
|------|------|------|------|
| 2024 | 100 | 万 | [3] |
| 2025 | 150 | 万 | [4] |

## 原始数据片段1: [无法表格化的数据]
- 数据点1: 具体信息 [来源 5]
- 数据点2: 具体信息 [来源 6]
\`\`\`

## 🔧 数据处理优先级
1. **第一优先级**: DataBus中的完整结构化数据（JSON/表格）
2. **第二优先级**: 从摘要中提取的结构化片段  
3. **第三优先级**: 无法结构化的原始文本（以列表形式展示）
4. **第四优先级**: 丢弃所有非数据内容

## 📋 质量等级标准（仅用于标注）
- **A级**: 数据完整，来源可靠，格式统一
- **B级**: 数据基本完整，来源一般，格式基本统一  
- **C级**: 数据缺失，来源单一，格式混乱
- **D级**: 数据不可用或无效

## 🔄 场景适配规则
系统会自动检测场景并调整表格主题，但核心输出规则不变：
1. 只输出数据表格
2. 不添加任何描述
3. 标注质量和来源
4. 保持数据原貌
`
    },
    researchMode: "data_mining"
},

// 在 ReportTemplates 对象中添加
us_stock: {
    name: "美股深度研究报告",
    description: "基于用户上传的财务数据和实时市场信息，生成一份投行级的美股深度研究报告。",
    config: {
        dynamic_structure: true,
        structure: [
            "# [模型根据公司特性和核心发现，自主生成一个深刻、精炼的报告标题]",
            "## 摘要 (Executive Summary)",
            "   - [对整个研究最核心的洞察、关键的投资结论进行高度浓缩的概括，约300-500字，面向投资决策者]",
            "## 一、投资亮点与核心驱动因素 (Investment Highlights & Key Drivers)",
            "   - [总结公司的主要投资亮点，如市场份额、产品创新、管理团队等]",
            "   - [识别未来增长的核心驱动因素，如行业趋势、新产品周期、成本优化等]",
            "## 二、公司概况与业务模式 (Company Overview & Business Model)",
            "   - [简要介绍公司历史、主营业务、商业模式、收入构成等]",
            "   - [可利用上传的财务数据中的公司概况信息]",
            "## 三、行业与竞争格局分析 (Industry & Competitive Landscape)",
            "   - [分析公司所处行业的市场规模、增长率、周期性、政策环境等]",
            "   - [识别主要竞争对手，进行市场份额对比，分析公司的竞争优势（如技术、品牌、成本）]",
            "   - [必须使用来自tavily_search或crawl4ai的最新行业报告、新闻等]",
            "## 四、基础财务数据概览 (Basic Financial Overview from Base Financials)",
            "以下分析基于[公司名称]截至2025财年的完整历史财务数据。基础数据来源：AlphaVantage。",
            "   - [必须基于用户上传的“基础财务数据详表”Markdown文件（该文件通常文件名包含 `base_financials` 关键词，键名如 `upload_1_[公司代码]_base_financials_md`）。该文件包含公司多年的原始财务数据（损益表、资产负债表、现金流量表）、同比变化、复合年增长率（CAGR）以及详细的财务健康评分模型。]",
            "   - [必须完整呈现以下核心内容（示例，“美股深度研究核心要求”中的指引（2.1节））：",
            "       1. 公司基本信息：名称、所属行业。",
            "       2. 最新年度核心规模指标：总资产、总负债、股东权益、营收、净利润、经营现金流、自由现金流、资本支出、研发费用等（从损益表、资产负债表、现金流量表中提取）。",
            "       3. 增长趋势指标：近3年/5年/全部年份的CAGR（营收、净利润、总资产、股东权益、经营现金流、自由现金流、每股收益）。",
            "       4. 历史趋势数据（近3-5年）：以表格形式展示营收、净利润、自由现金流、资本支出、营运资本，并附同比变化率。",
            "       5. 高级财务指标：有效税率、EBITDA利润率、资本支出/折旧、营运资本变动，以及财务健康评分模型的历年评分结果（总分、评级、各维度得分及依据）。]",
            "   - [本节基于用户上传的“基础财务数据详表”Markdown文件（键名如 `upload_1_[公司代码]_base_financials_md`）。该文件包含公司多年的原始财务数据（损益表、资产负债表、现金流量表）、同比变化、复合年增长率（CAGR）以及详细的财务健康评分模型。请严格按照“美股深度研究核心要求”中的指引（2.1节）提取和呈现数据，并进行深度解读。]",
            "## 五、财务深度分析 (In-Depth Financial Analysis)",
            "以下分析基于[公司名称]截至2025财年的完整历史财务数据。基础数据来源：AlphaVantage。",
            "   - [本节基于用户上传的“财务比率历史数据”Markdown文件（键名如 `upload_2_[公司代码]_report_md`）。该文件包含五大类历史财务比率表格（盈利能力、流动性、杠杆、效率、现金流）。]",
            "   - [必须完整呈现上传Markdown文件中的五大类表格，并对每个表格进行详细解读，分析各项比率的变化趋势及其背后的业务驱动因素，结合行业背景说明。]",
            "## 六、经营变化趋势分析 (Trend & Change Analysis)",
            "   - 选取关键指标（如营收、净利润、自由现金流、ROE、毛利率），计算最近年份相对于前几年的年增长率/变化百分比。",
            "   - 制作趋势摘要表格（示例格式，需填充具体数据）：",
            "     | 指标 | 最新值 | 前一年值 | 变化幅度 | 趋势方向 | 可能原因 |",
            "     |------|--------|----------|----------|----------|----------|",
            "     | ... | ... | ... | ... | 改善/恶化 | 结合搜索解释 |",
            "   - 结合搜索到的行业动态、公司新闻，解释指标变化的原因。",
            "   - 综合评价公司经营状况是向好、稳定还是向差，并指出关键驱动因素。",
            "## 七、风险因素 (Risk Factors)",
            "   - [需涵盖宏观、行业、公司特定风险，可结合搜索获取的最新信息。]",
            "## 八、综合结论与经营评价 (Conclusion & Business Assessment)",
            "   - [基于以上分析，给出公司整体经营质量的评价（如优秀、良好、一般、较差）。]",
            "   - [总结公司的核心竞争力和主要挑战。]",
            "   - [提出需要持续跟踪的关键经营指标。]",
            "## 资料来源 (Sources)",
            "   - [系统将自动附加此部分]"
        ],
        wordCount: "8000-10000字（以分析彻底性为准）",
        style: "投行级、数据驱动、逻辑严谨、前瞻性",
        requirements: `
## 🎯 美股深度研究核心要求

### 1. 数据驱动原则 (Data-Driven Principle)
- **必须充分利用用户上传的两个财务数据文件**（均已存入数据总线 DataBus，键名分别为 \`upload_1_financial_ratio_result_json\` 和 \`upload_2_[公司代码]_report_md\`，例如 \`upload_2_AAPL_report_md\`）。其中：
  - **基础数据文件（JSON）**：包含公司多年的基础财务数据，如营收、净利润、自由现金流、增长率、分部门数据（若有）、历史年度数据等。这些数据是第四部分分析的核心。
  - **比率数据文件（Markdown）**：包含五大类历史财务比率表格（盈利能力、流动性、杠杆、效率、现金流），用于第五部分的深入解读。
- 对于外部信息（行业数据、竞争对手信息、新闻等），必须使用tavily_search或crawl4ai获取，并标注来源。

### 2. 财务与行业融合的深度分析指引（适用于所有行业）
  #### 2.1 基础财务数据概览（第四部分）
**数据提取与呈现要求**（严格遵循以下格式）：

##### 2.1.1 公司基本信息
从文件开头获取公司名称、股票代码、行业分类、数据覆盖年份。

##### 2.1.2 最新年度核心规模指标
最新年度指表格中最后一列（年份最大）的数据，例如2025年。请以下表形式展示（单位：百万美元，可直接使用文件中的B/M单位，并在表格下方说明换算关系）：

| 指标 | 最新年度（2025） | 来源表格 |
|------|------------------|----------|
| 总资产 | [从“资产负债表-总资产”表格提取] | 资产负债表 |
| 总负债 | [从“资产负债表-总负债”表格提取] | 资产负债表 |
| 股东权益 | [从“资产负债表-股东权益”表格提取] | 资产负债表 |
| 营收 | [从“损益表-总营收”表格提取] | 损益表 |
| 净利润 | [从“损益表-净利润”表格提取] | 损益表 |
| EBITDA | [从“损益表-EBITDA”表格提取] | 损益表 |
| 经营现金流 | [从“现金流量表-经营活动现金流”表格提取] | 现金流量表 |
| 资本支出 | [从“现金流量表-资本支出”表格提取] | 现金流量表 |
| 自由现金流 | [从“现金流量表-自由现金流”表格提取] | 现金流量表 |
| 研发费用 | [从“损益表-研发费用”表格提取] | 损益表 |
| 每股收益 | [从“每股数据-每股收益”表格提取] | 每股数据 |
| 营运资本 | [从“资产负债表-营运资本”表格提取] | 资产负债表 |

*注：文件中的B代表十亿美元（即1000百万美元），M代表百万美元。*

##### 2.1.3 增长趋势指标（CAGR）
从“复合年增长率 (CAGR)”部分直接复制以下表格（保持原样）：

| 指标 | 近3年CAGR | 近5年CAGR | 全部年份CAGR |
|------|-----------|-----------|--------------|
| 营收 | ... | ... | ... |
| 净利润 | ... | ... | ... |
| 总资产 | ... | ... | ... |
| 股东权益 | ... | ... | ... |
| 经营现金流 | ... | ... | ... |
| 自由现金流 | ... | ... | ... |
| 每股收益 | ... | ... | ... |

##### 2.1.4 历史趋势数据（近5年）
请按三大报表分类，分别制作近5年（例如2021-2025年）的趋势表格。每个表格需包含文件中有数据的全部主要科目，并附同比变化率（可直接引用文件中的“同比增长”列）。

**损益表趋势**（至少包含：总营收、营业成本、毛利、营业利润、净利润、EBITDA、研发费用、销售管理费用、有效税率）

| 财年 | 总营收 | 营收同比 | 营业成本 | 毛利 | 营业利润 | 净利润 | 净利润同比 | EBITDA | 研发费用 | 有效税率 |
|------|--------|----------|----------|------|----------|--------|------------|--------|----------|----------|
| 2025 | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |
| 2024 | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |
| 2023 | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |
| 2022 | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |
| 2021 | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

**资产负债表趋势**（至少包含：总资产、总负债、股东权益、流动资产、流动负债、现金、存货、应收账款、应付账款、总债务、营运资本）

| 财年 | 总资产 | 总资产同比 | 总负债 | 股东权益 | 流动资产 | 流动负债 | 现金 | 存货 | 应收账款 | 应付账款 | 总债务 | 营运资本 |
|------|--------|------------|--------|----------|----------|----------|------|------|----------|----------|--------|----------|
| 2025 | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

**现金流量表趋势**（至少包含：经营现金流、资本支出、自由现金流、投资现金流、筹资现金流、股息支付、股份回购）

| 财年 | 经营现金流 | 同比 | 资本支出 | 同比 | 自由现金流 | 同比 | 投资现金流 | 筹资现金流 | 股息支付 | 股份回购 |
|------|------------|------|----------|------|------------|------|------------|------------|----------|----------|
| 2025 | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

**营运资本变动**：直接从“营运资本变动”表格中提取近5年的变动值，作为补充。

| 财年 | 营运资本变动 |
|------|--------------|
| 2025 | ... |
| 2024 | ... |
| ... | ... |

##### 2.1.5 高级财务指标
- **有效税率**、**EBITDA利润率**、**资本支出/折旧**：从文件中相应表格提取最新年度数值及历史趋势（已在上述历史表格中体现）。
- **财务健康评分**：从“财务健康评分模型”部分复制历年总分、评级及各维度得分与依据（可直接引用该节内容，保持原样）。例如：

#### 2025年
- **总分**：76.0 — 健康
- **综合解读**：财务状况健康，大部分维度良好
- 各维度得分及依据：
  - 盈利能力（权重30%）：100分，ROE 151.91% > 20%，盈利能力优秀
  - 流动性（权重20%）：40分，流动比率 0.89 在0.8-1.0之间，流动性紧张
  - 杠杆（权重20%）：40分，负债权益比 1.37 在1.0-2.0之间，杠杆偏高
  - 效率（权重15%）：100分，资产周转率 1.16 > 1.0，资产使用效率极高
  - 现金流（权重15%）：100分，自由现金流利润率 23.73% > 15%，现金生成能力极强

##### 2.1.6 数据解读
对以上每个表格和指标进行文字解读，解释数值含义、近年变化趋势。

**必须结合行业背景**：使用 tavily_search 或 crawl4ai 获取公司所处行业的最新研究报告、行业平均增速、竞争格局等信息，将公司数据与行业基准进行对比分析，说明驱动因素（如产品创新、成本控制、供应链优化等）。

例如：
- 若营收CAGR高于行业平均水平，可归因于产品创新或市场份额提升。
- 若自由现金流强劲，可结合资本开支周期分析（如资本支出下降释放现金流）。
- 若财务健康评分提升，需指出哪些维度改善（如杠杆下降、效率提升）。

  #### 2.2 核心财务比率解读（第五部分）
- 完整呈现五大类比率表格：从文件中原样复制**盈利能力、流动性、杠杆、效率、现金流**五大类表格，保持所有行、列和格式不变（包括表头、分隔线、数据单元格），保持Markdown格式。
- **对每类比率进行深度解读**：
  - **盈利能力**：分析ROE、ROA、毛利率、净利率、ROIC的变化趋势，结合行业背景说明驱动因素（如产品定价权、成本控制、服务业务占比提升）。使用搜索获取的行业数据对比。
  - **流动性**：评估流动比率、速动比率、现金比率的变化，解释与公司运营模式的关系（如负营运资本反映供应链议价能力）。对比行业平均。
  - **杠杆**：分析负债权益比、资产负债率、利息保障倍数的变化，判断财务风险是否可控，结合行业资本结构特点。
  - **效率**：解读资产周转率、存货周转天数、应收账款周转天数、应付账款周转天数、现金转换周期的变化，反映运营效率。可结合公司战略（如JIT库存管理）分析。
  - **现金流**：分析自由现金流、资本支出相关比率，评估盈利质量和再投资力度，结合资本开支周期。
- **数据解读要求**：
  - 每个指标需结合行业背景和公司战略（如自研芯片、服务业务）进行解释，避免简单罗列数字。
  - 例如：若存货周转天数下降，可归因于供应链优化或产品热销；若应收账款周转天数上升，需关注回款政策变化。

### 3. 经营变化趋势分析指引
- **计算关键指标的年增长率或变化百分比**：对于关键指标（如营收、净利润、自由现金流、ROE、毛利率等），计算最近年份相对于前几年的年增长率或变化百分比，明确其变化趋势。
- **识别趋势方向**：明确哪些指标在改善（如毛利率上升、负债率下降），哪些在恶化（如应收账款周转天数增加）。
- **多维度呈现**：可制作一个简洁的趋势摘要表格，包含指标名称、最新值、前一年值、变化幅度及方向。
- **原因探究**：结合公司新闻、行业动态（搜索获取）来解释指标变化的原因。例如，若毛利率提升，可能源于产品涨价或原材料成本下降；若存货周转天数上升，可能预示销售放缓或库存积压。
- **综合评价**：基于趋势分析，总结公司经营是在向好、稳定还是向差，并指出关键驱动因素。

### 4. 时效性验证 (Temporal Validation)
- 公司最新财报季度的数据应在财务分析中突出显示。
- 行业分析和新闻必须使用最新的可用信息（过去6个月内）。

### 5. 风险因素全面性 (Comprehensive Risk Factors)
- 识别至少三类风险：宏观风险（经济周期、利率、汇率）、行业风险（竞争加剧、技术变革）、公司特有风险（管理层变动、产品依赖、法律诉讼）。
- 评估风险发生的可能性和潜在影响。

### 6. 经营评价的客观性 (Objective Business Assessment)
- 结论应基于数据和事实，避免主观臆断。给出公司整体经营质量的评价（如优秀、良好、一般、较差），并说明依据。
- **不提供具体的买入/卖出建议，也不预测股价**。将价格判断留给用户。
- 提出需要持续跟踪的关键经营指标，帮助用户把握公司动态。

### 7. 结构与自主性 (Structure & Autonomy)
- 上述章节仅为建议，你可以根据公司的具体情况和研究过程中的发现，自主调整章节顺序和内容深度。
- 例如，如果公司是周期股，可重点分析宏观经济和供需；如果是成长股，可侧重市场空间和产品创新。
- 确保报告逻辑连贯，像一位专业分析师撰写。
`
    },
    researchMode: "us_stock"
},

    // 🎯 【优化升级版】标准动态报告
    // 🔧 【调试/审计模式】全链路系统执行日志 (原标准模式改版)
    standard: {
        name: "系统全链路调试日志 (System Audit Log)",
        description: "开发者专用模式。输出极高颗粒度的执行细节、Token消耗分析、工具调用诊断、思维链回溯及基于Anthropic方法的智能评估。",
        config: {
            // 保持动态结构，但完全改变其生成逻辑
            dynamic_structure: true,
            
            structure: [
                "# 🛠️ 系统执行审计报告 (System Execution Audit Report)",
                
                "## 1. 任务元数据与初始化 (Metadata & Initialization)",
                "   - **任务目标**: [原文复述用户的核心需求]",
                "   - **意图识别**: [分析用户意图的类型（如：数据查询、深度分析、代码生成）]",
                "   - **初始规划**: [展示生成的初始 Research Plan，并评价其合理性]",
                "   - **时效性判定**: [系统对时效性的评估结果（高/中/低）及其依据]",

                "## 2. 执行链路深度回溯 (Execution Trace & Analysis)",
                "   - [这是一个核心章节。请遍历每一个'中间步骤 (intermediateSteps)'，按时间顺序生成详细日志]",
                "   - **Step N: [工具名称]**",
                "     - **思考 (Thought)**: [复盘当时的决策逻辑：为什么选这个工具？期望得到什么？]",
                "     - **输入 (Input)**: [展示工具调用的核心参数，如搜索词、URL、代码片段]",
                "     - **观察 (Observation)**: [摘要工具返回的核心数据，如果是代码，指出是否有报错]",
                "     - **反思 (Reflection)**: [评价这一步是否成功？信息增益 (Information Gain) 是高还是低？]",

                "## 3. 数据流与上下文完整性 (Data Flow & Context)",
                "   - **关键发现提取**: [列出在过程中捕获的 Top 5 关键信息点]",
                "   - **数据丢失警报**: [指出哪些步骤抓取了大量内容但被摘要压缩了，是否存在关键细节丢失的风险]",
                "   - **幻觉检测**: [自我审查：是否有哪一步的结论缺乏证据支持？]",

                "## 4. 异常与错误诊断 (Error Diagnostics)",
                "   - [如果在执行过程中出现了任何 Error（如解析失败、网络超时、代码报错），在此集中展示]",
                "   - **错误详情**: [错误信息原文]",
                "   - **系统应对**: [系统是如何处理这个错误的（如重试、降级、修正）]",
                "   - **优化建议**: [针对此错误，Prompt 或代码逻辑应如何改进]",

                "## 5. 性能与成本评估 (Performance & Cost)",
                "   - **迭代效率**: [总迭代次数 / 有效迭代次数]",
                "   - **工具效能**: [哪个工具贡献了最大的信息价值？哪个工具是无效调用？]",
                "   - **最终总结**: [用一句话评价本次 Agent 任务执行的整体表现（优秀/合格/失败）]",

                // 🎯 【新增】增强评估章节
                "## 6. Anthropic方法智能评估 (Intelligent Evaluation)",
                "   - **评估框架**: 基于Anthropic AI Agent评估方法的多维度分析",
                "   - **评估维度**:",
                "     - **决策质量 (Decision Quality)**: Agent思考逻辑、工具选择合理性",
                "     - **工具效率 (Tool Efficiency)**: 工具调用成功率、输出质量、资源利用",
                "     - **信息增益 (Information Gain)**: 步骤间信息新颖性、数据价值密度",
                "     - **成本效益 (Cost Effectiveness)**: Token消耗与信息产出比例",
                "     - **安全性合规 (Safety Compliance)**: 代码安全、访问控制、风险操作检测",
                "   - **评估结果**: [系统将自动插入全方位评估报告]",

                "## 7. 优化建议与改进路线 (Optimization Roadmap)",
                "   - **立即行动项**: [基于评估结果，提出3-5个可立即实施的优化点]",
                "   - **短期改进**: [接下来1-2周可完成的优化任务]",
                "   - **长期规划**: [系统架构和策略层面的改进方向]",

                "## 附录：原始资料清单 (Raw Sources)",
                "   - [列出所有涉及的 URL，不进行格式化，方便开发者点击验证]"
            ],
            
            wordCount: "不限 (以完整记录过程为准)",
            style: "技术性、客观、分析性、直白 (Technical, Objective, Analytical, Raw)",
            
            // 🎯 增强的要求说明
            requirements: `
请完全抛弃'给用户看报告'的心态，转变为'给开发者看日志'。**不要美化过程**，如果某一步很愚蠢（例如重复搜索），请直白地记录并指出。重点在于**暴露系统运行的内部状态和逻辑断点**。

## 🔍 增强评估要求

### 1. 决策质量深度分析
- **思考有效性**: 评估每个步骤的思考是否真正指导了行动
- **工具匹配度**: 分析工具选择是否适合当前子问题
- **参数合理性**: 检查工具参数是否优化

### 2. 工具效率多维度评估
- **成功率统计**: 计算每个工具的成功调用率
- **输出质量**: 评估工具返回信息的完整性、准确性和相关性
- **时间效率**: 分析工具调用耗时与信息获取的价值比

### 3. 信息增益量化分析
- **新颖性评分**: 计算每个步骤相对于之前步骤的信息新颖度
- **价值密度**: 评估信息中包含的关键数据、事实、观点的密度
- **重复率检测**: 识别重复或高度相似的信息获取

### 4. 成本效益透明化
- **Token使用明细**: 按步骤分解Token消耗
- **信息产出评估**: 计算每Token产出的有效信息量
- **效率基准**: 与历史执行或理想基准对比

### 5. 安全性全面审查
- **代码安全**: 检查所有执行的代码片段是否存在安全隐患
- **访问控制**: 评估URL访问是否合规
- **风险操作**: 识别潜在的危险操作或参数

### 6. 可操作建议
- **基于数据**: 所有建议必须基于具体的评估数据
- **优先级排序**: 按照影响程度和实施难度排序
- **具体方案**: 提供具体的实施步骤和预期效果

## 🎯 输出格式要求
- **结构化**: 使用清晰的标题层级和列表
- **数据驱动**: 每个观点都要有具体数据支撑
- **对比分析**: 与理想状态或历史执行对比
- **可追溯**: 所有结论都能追溯到具体的步骤或数据`
        },
        researchMode: "standard"
    }
};

// ✨ 工具函数：获取模板配置
export function getTemplateConfig(templateKey) {
    return ReportTemplates[templateKey] || ReportTemplates.standard;
}

// ✨ 工具函数：获取所有可用模板
export function getAvailableTemplates() {
    return Object.entries(ReportTemplates).map(([key, template]) => ({
        key,
        name: template.name,
        description: template.description,
        wordCount: template.config.wordCount,
        style: template.config.style
    }));
}

// ✨ 新增：根据研究模式获取对应的模板配置
export function getTemplateByResearchMode(researchMode) {
    const modeToTemplate = {
        'deep': 'deep',
        'academic': 'academic',
        'business': 'business',
        'technical': 'technical',
        'data_mining': 'data_mining',
        'standard': 'standard'
    };
    
    const templateKey = modeToTemplate[researchMode] || 'standard';
    return getTemplateConfig(templateKey);
}

// ✨ 新增：获取模板的提示词片段 - 核心DRY函数
export function getTemplatePromptFragment(templateKey) {
    const template = getTemplateConfig(templateKey);
    if (!template) return '';
    
    return `
## 5. 最终报告要求（${template.name}）

**报告结构**：
${template.config.structure.map(section => `- ${section}`).join('\n')}

**详细要求**：
- 字数：${template.config.wordCount}
- 风格：${template.config.style}
- 质量：${template.config.requirements}

## 🎓 引用与论证规范 (Evidence & Argumentation Protocol)

为了保证报告的学术严谨性与论证的彻底性，请遵循以下写作规范：

1.  **论证驱动引用 (Argument-Driven Citation)**：
    - 引用资料的目的是为了【支撑你的论点】或【提供关键证据】，而非简单罗列。
    - 在正文中引用数据或观点时，请自然地提及信息来源的主体（语义化引用）。
    - **推荐写法**：
        *   "根据**国家统计局**发布的2023年公报显示..."
        *   "《**深度学习综述**》一文中指出..."
        *   "权威数据显示..." (并在句末标记索引)

2.  **索引辅助 (Index Aid)**：
    - 我已为所有资料来源标记了编号（如 [1], [2]）。
    - 你**必须**在所有引用了外部信息的句子末尾，使用 \`[x]\` 或 \`[x, y]\` 来清晰标记资料来源。
    - **最重要的是信息准确**，确保每一个论据都有可追溯的来源。

3.  **严禁行为**：
    - **禁止**在正文中直接粘贴 URL 链接。
    - **禁止**手动编写"参考文献"章节（系统会自动根据你的引用内容生成标准列表）。

**目标**：请专注于内容的深度整合与【论证的严密性】，像一位真正的人类研究员那样撰写报告。
`;
}