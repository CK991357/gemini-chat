// src/static/js/agent/deepresearch/ReportTemplates.js

export const ReportTemplates = {
    // ✨ 深度研究模式 - 优化章节结构
    // 🎯 【全新升级版】深度专家报告 (Deep Expert)
    deep: {
        name: "深度专家报告",
        description: "一份由AI自主规划、结构动态生成、聚焦最终成果的极致深度分析报告。",
        config: {
            // 🔥 1. 开启动态结构，赋予模型自主权
            dynamic_structure: true,

            // 🔥 2. 移除“研究脉-络”章节，聚焦最终成果
            structure: [
                "# [模型根据研究主题和核心发现，自主生成一个深刻、精炼、直指问题核心的主标题]",
                "## 摘要 (Executive Summary)",
                "   - [对整个研究最核心的洞察、最关键的结论进行高度浓缩的概括，约300-500字，面向决策者]",
                "## 一、引言：问题与背景 (Introduction: Problem & Context)",
                "   - [清晰地界定本次研究的核心问题、其重要性及当前的背景。阐述本报告将从哪些维度进行深度剖析。]",
                "## [二、三、四...] [根据研究计划中的'sub_question'，自主将每个步骤扩展成一个独立的、论证充分的核心章节]",
                "   - [章节标题应自主提炼，必须专业且能概括该章节的核心论点，而不是简单复述子问题。]",
                // ▼▼▼ 将“篇幅”要求改为“深度”要求 ▼▼▼
                "   - [本章是报告的核心，必须进行详细的、多角度的展开论述。你需要通过【至少三种】不同的论据（如：技术原理分析、模型案例对比、性能数据支撑、行业专家观点等）来支撑你的核心论点，确保内容的深度和说服力。]",
                "   - [每个章节内部，必须对相关的所有'观察(observation)'信息进行深度的综合、分析、提炼和论证，而不仅仅是罗列。]",
                "   - [必须包含对不同观点、技术路线或市场方案的【对比分析】和【辩证思考】。]",
                "   - [**深度标志**：报告中必须明确包含一个“辩证分析”或“多角度对比”的核心章节，专门用于探讨不同观点的冲突与融合、技术的优劣势权衡、或理论的局限性。]",
                "   - [所有关键数据、论点必须在句末清晰地引用资料来源，例如：'该技术路线的实现复杂度较高 [来源 1, 3]。']",
                "## 五、综合解决方案与战略建议 (Synthesized Solutions & Strategic Recommendations) (可选，如果适用)",
                "   - [基于前文的深度分析，设计出创新的、多层次的综合解决方案或战略框架。]",
                "   - [对每个方案进行SWOT分析（优势、劣势、机会、威胁），并给出明确的决策建议。]",
                "## 六、结论与未来展望 (Conclusion & Future Outlook)",
                "   - [全面总结报告的核心洞见，形成一个有穿透力的最终结论。]",
                "   - [基于研究结论，预测未来3-5年的发展趋势、潜在的颠覆性变量以及需要持续关注的关键问题。]",
                "## 资料来源 (Sources)",
                "   - [系统将自动附加此部分]"
            ],
            
            // 🔥 5. 大幅提升字数要求
            wordCount: "动态调整 (通常在8000-12000字，但以论证的彻底性为首要标准，不设上限)",
            style: "极致专业、逻辑严密、论证充分、富有洞察力、前瞻性。",
            requirements: "报告必须体现出对复杂问题的根本性解构和高度综合分析能力。**核心要求是论证的【彻底性】和【严谨性】，而非单纯的字数堆砌。** 确保每一个核心观点都有从【完整抓取内容（crawl4ai）】中提取充分的数据、案例或理论支撑，并进行了深入的辩证分析。"
        },
        researchMode: "deep"
    },

    // 📊 行业分析报告 - 完全重构
    business: {
        name: "行业分析报告",
        description: "全面的行业现状扫描、竞争格局分析与发展趋势预测",
        config: {
            structure: [
                "# 行业全景扫描",
                "## 一、行业核心概览", 
                "### 行业定义与范畴界定",
                "### 市场规模与增长动力",
                "### 生命周期阶段判断",
                "## 二、产业链与价值分布",
                "### 上下游产业链分析",
                "### 价值链与利润分布",
                "### 关键环节与瓶颈识别",
                "## 三、竞争格局深度分析", 
                "### 市场集中度与竞争态势",
                "### 主要参与者战略分析",
                "### 竞争优势与壁垒评估",
                "## 四、驱动因素与趋势判断",
                "### 技术/政策/需求驱动因素",
                "### 短期与中长期趋势预测", 
                "### 潜在颠覆性变化预警",
                "## 五、机会识别与战略建议",
                "### 投资机会与风险提示",
                "### 进入/退出策略建议",
                "### 成功关键要素总结"
            ],
            wordCount: "2200-3000字",
            style: "全景扫描、深度洞察、前瞻判断", 
            requirements: "基于权威数据和事实，提供可验证的趋势判断和实用战略建议"
        },
        researchMode: "business"
    },

    // 📝 学术论文整理模式 - 优化结构
    academic: {
        name: "学术论文深度解析报告",
        description: "对学术论文的全面深度分析，包括研究脉络、方法验证、相关工作和未来方向",
        config: {
            // 🔥 核心修改：启用动态结构
            dynamic_structure: true,
            
            structure: [
                "# [基于论文核心贡献和发现，自主生成一个深刻、精炼的学术标题]",
                "## 摘要 (Executive Summary)",
                "   - [对整个论文最核心的贡献、最关键的技术突破进行高度浓缩的概括，约300-500字，面向学术同行和决策者]",
                "## 一、引言：研究问题与学术定位 (Introduction: Research Problem & Academic Positioning)",
                "   - [清晰地界定论文要解决的核心学术问题、其在领域中的重要性及当前的技术瓶颈]",
                "   - [阐述本分析将从哪些维度进行深度剖析，以及论文在学术脉络中的定位]",
                "## [二、三、四...] [根据研究计划中的'sub_question'，自主将每个步骤扩展成独立的深度分析章节]",
                "   - [章节标题应自主提炼，必须专业且能概括该章节的核心学术论点，而不是简单复述子问题]",
                "   - [本章是分析的核心，必须进行详细的、多角度的技术展开。你需要通过【至少三种】不同的论据（如：技术原理深度解析、实验数据验证、与相关工作对比、理论创新分析等）来支撑你的核心论点]",
                "   - [每个章节内部，必须对相关的所有'观察(observation)'信息进行深度的学术综合、批判性分析和提炼论证]",
                "   - [必须包含对技术路线、方法选择、实验结果的不同观点或替代方案的【辩证分析】]",
                "   - [**深度标志**：报告中必须明确包含一个\"技术路线对比\"或\"方法优劣分析\"的核心章节，专门用于探讨不同技术方案的权衡、局限性和创新点]",
                "   - [所有关键技术论点、实验数据必须在句末清晰地引用资料来源，例如：'该方法的准确率比基线提升15.3% [来源 1, 3]']",
                "## [倒数第二章] 综合评估与学术贡献 (Synthesized Assessment & Academic Contributions)",
                "   - [基于前文的深度分析，系统评估论文的学术价值和技术创新]",
                "   - [对论文的贡献进行多维度总结：理论创新、方法突破、应用价值等]",
                "   - [客观分析论文的局限性和改进空间，提出建设性批判]",
                "## 结论与领域展望 (Conclusion & Field Outlook)",
                "   - [全面总结分析的核心洞见，形成有深度的最终评价]",
                "   - [基于论文贡献，预测该研究方向未来3-5年的发展趋势、技术演进路径和潜在突破点]",
                "## 资料来源 (Sources)",
                "   - [系统将自动附加此部分]"
            ],
            
            wordCount: "3000-5000字",
            style: "学术严谨、深度分析、批判性思维、结构化表达",
            requirements: "必须基于论文原文进行深度技术解析，每个核心观点都需要具体的技术细节和实验数据支撑。避免泛泛而谈，专注于学术价值和创新性分析。使用结构化表达增强可读性，突出核心贡献和技术突破。必须包含批判性思考和辩证分析。"
        },
        researchMode: "academic"
    },

    // 🛠️ 技术实现文档 - 优化结构
    technical: {
        name: "技术实现深度指南",
        description: "基于需求分析的全套技术实现方案，包含架构设计、代码示例、部署指南和最佳实践",
        config: {
            // 🔥 开启动态结构，基于技术需求自动生成最相关的章节
            dynamic_structure: true,

            // 🔥 技术实现专用结构 - 聚焦可落地性
            structure: [
                "# [基于技术需求和核心方案，自主生成一个精准的技术实现标题]",
                "## 技术方案摘要 (Technical Solution Summary)",
                "   - [用200-300字高度概括技术栈选择、核心架构和关键实现方案，面向技术决策者]",
                "## 一、需求分析与技术选型 (Requirements Analysis & Tech Stack)",
                "   - [深入分析用户的技术需求、性能要求、约束条件和业务场景]",
                "   - [基于需求论证技术栈选择的合理性，对比不同方案的优劣]",
                "   - [明确技术选型的决策依据和权衡考量]",
                "## [二、三、四...] [根据研究计划中的技术实现步骤，自主生成深度技术章节]",
                "   - [章节标题应体现具体的技术实现维度，如：'系统架构设计'、'核心算法实现'、'数据库设计'等]",
                "   - [每个技术章节必须包含：技术原理、实现方案、代码示例、性能考量]",
                "   - [**代码质量要求**：所有代码示例必须完整、可运行、有详细注释，包含错误处理]",
                "   - [**实践导向**：提供具体的配置示例、参数调优建议和性能优化技巧]",
                "   - [**避坑指南**：必须包含常见问题解决方案和最佳实践建议]",
                "   - [所有技术决策必须有明确的理由支撑，避免'因为流行而选择']",
                "## [倒数第二章] 部署与运维指南 (Deployment & Operations)",
                "   - [提供完整的部署流程，包括环境配置、依赖安装、部署步骤]",
                "   - [包含监控、日志、性能调优等运维相关配置]",
                "   - [提供健康检查、故障恢复和扩缩容方案]",
                "## 总结与技术展望 (Conclusion & Technical Outlook)",
                "   - [总结技术方案的核心价值和创新点]",
                "   - [基于当前实现，提出技术演进方向和优化建议]",
                "   - [预测可能的技术挑战和应对策略]",
                "## 附录：完整代码实现 (Appendix: Complete Code Implementation)",
                "   - [系统将自动整理所有代码示例，形成完整的可执行代码库]"
            ],
            
            wordCount: "2500-4000字（代码部分不计入）",
            style: "技术精准、实践导向、代码完整、避坑指南",
            requirements: "必须基于实际技术需求提供可落地的实现方案。所有技术选择都要有明确的理由，代码示例必须完整且包含错误处理。强调最佳实践和常见问题解决方案，避免理论空谈。"
        },
        researchMode: "technical"
    },

    // 🔬 前沿技术分析 - 优化结构
    cutting_edge: {
        name: "前沿技术分析",
        description: "对新兴技术的深度分析、发展脉络与应用前景评估",
        config: {
            structure: [
                "# 技术发展全景分析", 
                "## 一、技术本质与核心特性",
                "### 基本概念与创新点",
                "### 与传统技术对比优势",
                "## 二、发展历程与现状",
                "### 关键技术突破历程", 
                "### 当前发展阶段判断",
                "## 三、核心技术解析",
                "### 底层原理与工作机制",
                "### 性能指标与局限性",
                "## 四、应用前景与挑战", 
                "### 潜在应用领域分析",
                "### 商业化前景评估",
                "## 五、发展趋势判断",
                "### 技术演进方向预测",
                "### 投资与研究建议"
            ],
            wordCount: "1800-2500字", 
            style: "前瞻性、深度分析、实用导向",
            requirements: "基于最新研究和发展动态，提供有洞察力的趋势判断和实用建议"
        },
        researchMode: "cutting_edge"
    },

    // 🛍️ 优化后的：奢侈品导购对比模式
    shopping_guide: {
        name: "奢侈品导购对比",
        description: "基于用户个人情况的专业奢侈品对比分析，提供个性化购买建议",
        config: {
            structure: [
                "# 个性化商品对比分析报告",
                "## 一、用户需求分析",
                "### 用户基本情况总结",
                "### 核心需求与偏好梳理",
                "### 预算与使用场景分析",
                "## 二、候选商品基本信息",
                "### 品牌背景与定位分析",
                "### 商品系列与目标人群",
                "### 价格区间与价值定位",
                "## 三、个性化匹配度分析",
                "### 与用户肤质/需求匹配度",
                "### 适用性深度评估",
                "### 潜在问题预警",
                "## 四、核心参数详细对比",
                "### 成分/材质与用户需求匹配",
                "### 功能特性针对性分析",
                "### 使用便捷性与舒适度",
                "## 五、实际效果与口碑验证",
                "### 同类用户真实反馈分析",
                "### 专业评测结果参考",
                "### 长期使用效果评估",
                "## 六、价值与成本分析",
                "### 性价比深度分析",
                "### 维护成本与使用成本",
                "### 投资价值与保值率",
                "## 七、个性化购买建议",
                "### 最适合用户的具体推荐",
                "### 使用注意事项",
                "### 替代方案备选",
                "### 购买渠道与时机建议"
            ],
            wordCount: "2500-3500字",
            style: "个性化、专业细致、实用导向",
            requirements: "基于用户提供的具体信息进行深度个性化分析，结合权威商品信息和真实用户反馈，提供针对性的购买建议"
        },
        researchMode: "shopping_guide"
    },

    // 🎯 【优化升级版】标准动态报告
    // 🔧 【调试/审计模式】全链路系统执行日志 (原标准模式改版)
    standard: {
        name: "系统全链路调试日志 (System Audit Log)",
        description: "开发者专用模式。输出极高颗粒度的执行细节、Token消耗分析、工具调用诊断及思维链回溯，用于系统调优和能力评估。",
        config: {
            // 保持动态结构，但完全改变其生成逻辑
            dynamic_structure: true,
            
            structure: [
                "# 🛠️ 系统执行审计报告 (System Execution Audit Report)",
                
                "## 1. 任务元数据与初始化 (Metadata & Initialization)",
                "   - **任务目标**: [原文复述用户的核心需求]",
                "   - **意图识别**: [分析用户意图的类型（如：数据查询、深度分析、代码生成）]",
                "   - **初始规划**: [展示生成的初始 Research Plan，并评价其合理性]",
                "   - **时效性判定**: [系统对时效性的评估结果（高/中/低）及其依据]",

                "## 2. 执行链路深度回溯 (Execution Trace & Analysis)",
                "   - [这是一个核心章节。请遍历每一个'中间步骤 (intermediateSteps)'，按时间顺序生成详细日志]",
                "   - **Step N: [工具名称]**",
                "     - **思考 (Thought)**: [复盘当时的决策逻辑：为什么选这个工具？期望得到什么？]",
                "     - **输入 (Input)**: [展示工具调用的核心参数，如搜索词、URL、代码片段]",
                "     - **观察 (Observation)**: [摘要工具返回的核心数据，如果是代码，指出是否有报错]",
                "     - **反思 (Reflection)**: [评价这一步是否成功？信息增益 (Information Gain) 是高还是低？]",

                "## 3. 数据流与上下文完整性 (Data Flow & Context)",
                "   - **关键发现提取**: [列出在过程中捕获的 Top 5 关键信息点]",
                "   - **数据丢失警报**: [指出哪些步骤抓取了大量内容但被摘要压缩了，是否存在关键细节丢失的风险]",
                "   - **幻觉检测**: [自我审查：是否有哪一步的结论缺乏证据支持？]",

                "## 4. 异常与错误诊断 (Error Diagnostics)",
                "   - [如果在执行过程中出现了任何 Error（如解析失败、网络超时、代码报错），在此集中展示]",
                "   - **错误详情**: [错误信息原文]",
                "   - **系统应对**: [系统是如何处理这个错误的（如重试、降级、修正）]",
                "   - **优化建议**: [针对此错误，Prompt 或代码逻辑应如何改进]",

                "## 5. 性能与成本评估 (Performance & Cost)",
                "   - **迭代效率**: [总迭代次数 / 有效迭代次数]",
                "   - **工具效能**: [哪个工具贡献了最大的信息价值？哪个工具是无效调用？]",
                "   - **最终总结**: [用一句话评价本次 Agent 任务执行的整体表现（优秀/合格/失败）]",

                "## 附录：原始资料清单 (Raw Sources)",
                "   - [列出所有涉及的 URL，不进行格式化，方便开发者点击验证]"
            ],
            
            wordCount: "不限 (以完整记录过程为准)",
            style: "技术性、客观、分析性、直白 (Technical, Objective, Analytical, Raw)",
            requirements: "请完全抛弃'给用户看报告'的心态，转变为'给开发者看日志'。**不要美化过程**，如果某一步很愚蠢（例如重复搜索），请直白地记录并指出。重点在于**暴露系统运行的内部状态和逻辑断点**。"
        },
        researchMode: "standard"
    }
};

// ✨ 工具函数：获取模板配置
export function getTemplateConfig(templateKey) {
    return ReportTemplates[templateKey] || ReportTemplates.standard;
}

// ✨ 工具函数：获取所有可用模板
export function getAvailableTemplates() {
    return Object.entries(ReportTemplates).map(([key, template]) => ({
        key,
        name: template.name,
        description: template.description,
        wordCount: template.config.wordCount,
        style: template.config.style
    }));
}

// ✨ 新增：根据研究模式获取对应的模板配置
export function getTemplateByResearchMode(researchMode) {
    const modeToTemplate = {
        'deep': 'deep',
        'academic': 'academic',
        'business': 'business',
        'technical': 'technical',
        'cutting_edge': 'cutting_edge',
        'shopping_guide': 'shopping_guide',
        'standard': 'standard'
    };
    
    const templateKey = modeToTemplate[researchMode] || 'standard';
    return getTemplateConfig(templateKey);
}

// ✨ 新增：获取模板的提示词片段 - 核心DRY函数
export function getTemplatePromptFragment(templateKey) {
    const template = getTemplateConfig(templateKey);
    if (!template) return '';
    
    return `
## 5. 最终报告要求（${template.name}）

**报告结构**：
${template.config.structure.map(section => `- ${section}`).join('\n')}

**详细要求**：
- 字数：${template.config.wordCount}
- 风格：${template.config.style}
- 质量：${template.config.requirements}

## 🎓 引用与论证规范 (Evidence & Argumentation Protocol)

为了保证报告的学术严谨性与论证的彻底性，请遵循以下写作规范：

1.  **论证驱动引用 (Argument-Driven Citation)**：
    - 引用资料的目的是为了【支撑你的论点】或【提供关键证据】，而非简单罗列。
    - 在正文中引用数据或观点时，请自然地提及信息来源的主体（语义化引用）。
    - **推荐写法**：
        *   "根据**国家统计局**发布的2023年公报显示..."
        *   "《**深度学习综述**》一文中指出..."
        *   "权威数据显示..." (并在句末标记索引)

2.  **索引辅助 (Index Aid)**：
    - 我已为所有资料来源标记了编号（如 [1], [2]）。
    - 你**必须**在所有引用了外部信息的句子末尾，使用 \`[x]\` 或 \`[x, y]\` 来清晰标记资料来源。
    - **最重要的是信息准确**，确保每一个论据都有可追溯的来源。

3.  **严禁行为**：
    - **禁止**在正文中直接粘贴 URL 链接。
    - **禁止**手动编写“参考文献”章节（系统会自动根据你的引用内容生成标准列表）。

**目标**：请专注于内容的深度整合与【论证的严密性】，像一位真正的人类研究员那样撰写报告。
`;
}